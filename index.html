<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>#–ê–≥—Ä–æ_–º–æ—Ç–∏–≤–∞—à–∫–∞ ‚Äî –í—Ö—ñ–¥</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="login-page">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-mark">üåæ</div>
      <h1>#–ê–≥—Ä–æ_<em>–º–æ—Ç–∏–≤–∞—à–∫–∞</em></h1>
      <p>–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∏–π –¥–µ—Ä–∂–∞–≤–Ω–∏–π –∞–≥—Ä–∞—Ä–Ω–æ-–µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç</p>
    </div>

    <div id="login-error" style="display:none" class="alert alert-error"></div>

    <form id="login-form" onsubmit="handleLogin(event)">
      <div class="form-group">
        <label class="form-label">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞</label>
        <input class="form-input" type="email" id="login-email" placeholder="–≤–∞—à–∞@–ø–æ—à—Ç–∞.ua" required autocomplete="email">
      </div>
      <div class="form-group">
        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
        <input class="form-input" type="password" id="login-password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required autocomplete="current-password">
      </div>
      <button type="submit" class="btn btn-primary btn-full btn-lg" id="login-btn">
        –£–≤—ñ–π—Ç–∏
      </button>
    </form>

    <p style="text-align:center;margin-top:20px;font-size:13px;color:var(--text-muted)">
      –ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É? –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø—Ä–∏–π–º–∞–ª—å–Ω–æ—ó –∫–æ–º—ñ—Å—ñ—ó
    </p>
  </div>
</div>

<!-- Supabase JS (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="js/config.js"></script>
<script src="js/auth.js"></script>
<script>
// –Ø–∫—â–æ –≤–∂–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π ‚Äî –æ–¥—Ä–∞–∑—É –≤ –¥–æ–¥–∞—Ç–æ–∫
(async function() {
  try {
    // –¢–µ—Å—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Supabase
    console.log('Supabase URL:', SUPABASE_URL);
    console.log('DB client:', typeof db);

    var result = await db.auth.getSession();
    console.log('Session check OK:', result);

    if (result.data.session) {
      window.location.href = 'app.html';
    }
  } catch(e) {
    console.error('Init error:', e);
    var errDiv = document.getElementById('login-error');
    errDiv.textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑\'—î–¥–Ω–∞—Ç–∏—Å—è –∑ Supabase: ' + e.message;
    errDiv.style.display = 'flex';
  }
})();

async function handleLogin(e) {
  e.preventDefault();

  var btn = document.getElementById('login-btn');
  var errorDiv = document.getElementById('login-error');
  var email = document.getElementById('login-email').value.trim();
  var password = document.getElementById('login-password').value;

  // –°—Ö–æ–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –ø–æ–º–∏–ª–∫—É
  errorDiv.style.display = 'none';

  // –ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>';

  var result = await login(email, password);

  if (result.ok) {
    window.location.href = 'app.html';
  } else {
    errorDiv.textContent = result.message;
    errorDiv.style.display = 'flex';
    btn.disabled = false;
    btn.textContent = '–£–≤—ñ–π—Ç–∏';
  }
}
</script>
</body>
</html>
